-- Parti politique ou groupement politique ou independant
CREATE TABLE entites_politiques (
   id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
   nom VARCHAR2(50) UNIQUE NOT NULL,
   description VARCHAR2(100),
   PRIMARY KEY(id)
);

CREATE TABLE candidats (
   id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
   id_entite_politique NUMBER NOT NULL,
   information VARCHAR2(100), -- Nom complet d'un ou plusieurs candidats
   PRIMARY KEY(id),
   FOREIGN KEY(id_entite_politique) REFERENCES entites_politiques(id)
);

CREATE TABLE enregistrement_candidats (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    id_election NUMBER NOT NULL,
    id_candidat NUMBER NOT NULL,
    -- Presidential election: both id_district and id_municipalite are NULL
    -- Legislative election: id_district must NOT BE NULL
    -- Municipal et communal election: id_municipalite must NOT BE NULL
    id_district NUMBER, 
    id_municipalite NUMBER,
    numero_candidat NUMBER NOT NULL,
    chemin_photo VARCHAR2(150),
    date_enregistrement DATE NOT NULL,
    PRIMARY KEY(id),
    FOREIGN KEY(id_election) REFERENCES elections(id),
    FOREIGN KEY(id_candidat) REFERENCES candidats(id),
    FOREIGN KEY(id_district) REFERENCES districts(id),
    FOREIGN KEY(id_municipalite) REFERENCES municipalites(id),
    -- id_municipalite is used instead of id
    -- because of Antananarivo Renivohitra being a special case (regrouping 8 arrondissements)
    CONSTRAINT unique_candidat_election UNIQUE(id_election, id_candidat)
);

CREATE TABLE electeurs (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    cin CHAR(12) UNIQUE NOT NULL,
    nom VARCHAR2(50) NOT NULL,
    prenom VARCHAR2(50),
    genre SMALLINT NOT NULL, -- 0: Homme, 1: Femme
    PRIMARY KEY(id)
);

CREATE TABLE enregistrement_electeurs (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    id_election NUMBER NOT NULL,
    id_bv NUMBER NOT NULL,
    id_electeur NUMBER NOT NULL,
    date_enregistrement DATE,
    vote NUMBER NOT NULL, -- 0: a pas voté, 10: a voté
    PRIMARY KEY(id),
    FOREIGN KEY(id_election) REFERENCES elections(id),
    FOREIGN KEY(id_electeur) REFERENCES electeurs(id),
    FOREIGN KEY(id_bv) REFERENCES bv(id),
    CONSTRAINT unique_electeur_election UNIQUE(id_election, id_electeur)
);

CREATE TABLE code_qr (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    contenu VARCHAR2(150) UNIQUE NOT NULL,
    date_creation DATE NOT NULL,
    date_expiration DATE NOT NULL,
    PRIMARY KEY(id)
);