CREATE TABLE partis_politiques (
   id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
   nom VARCHAR2(50) UNIQUE NOT NULL,
   description VARCHAR2(100),
   PRIMARY KEY(id)
);

CREATE TABLE candidats (
   id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
   id_parti_politique NUMBER NOT NULL,
   nom VARCHAR2(50) NOT NULL,
   prenom VARCHAR2(50) NOT NULL,
   PRIMARY KEY(id),
   FOREIGN KEY(id_parti_politique) REFERENCES partis_politiques(id)
);

CREATE TABLE enregistrement_candidats (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    id_election NUMBER NOT NULL,
    id_candidat NUMBER NOT NULL,
    -- Presidential election: both id_district and id_commune are NULL
    -- Legislative election: id_district is NOT NULL and id_commune is NULL
    -- Municipal election: both id_district and id_commune are NOT NULL
    id_district NUMBER, 
    id_commune NUMBER,
    numero_candidat NUMBER NOT NULL,
    chemin_photo VARCHAR2(150),
    date_enregistrement DATE NOT NULL,
    PRIMARY KEY(id),
    FOREIGN KEY(id_election) REFERENCES election(id),
    FOREIGN KEY(id_candidat) REFERENCES candidats(id),
    FOREIGN KEY(id_district) REFERENCES districts(id),
    FOREIGN KEY(id_commune) REFERENCES communes(id),
    CONSTRAINT unique_numero_candidat_election UNIQUE(id_election, numero_candidat),
    CONSTRAINT unique_candidat_election UNIQUE(id_election, id_candidat)
);

CREATE TABLE electeurs (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    cin CHAR(12) UNIQUE NOT NULL,
    nom VARCHAR2(50) NOT NULL,
    prenom VARCHAR2(50),
    genre SMALLINT NOT NULL, -- 0: Homme, 1: Femme
    PRIMARY KEY(id)
);

CREATE TABLE enregistrement_electeurs (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    id_election NUMBER NOT NULL,
    id_bv NUMBER NOT NULL,
    id_electeur NUMBER NOT NULL,
    date_enregistrement DATE NOT NULL,
    vote NUMBER NOT NULL, -- 0: a pas voté, 1: a voté
    PRIMARY KEY(id),
    FOREIGN KEY(id_election) REFERENCES election(id),
    FOREIGN KEY(id_electeur) REFERENCES electeurs(id),
    FOREIGN KEY(id_bv) REFERENCES bv(id),
    CONSTRAINT unique_electeur_election UNIQUE(id_election, id_electeur)
);